#!/usr/bin/env bash

function print_help() {
  echo "

Switch vimrc files with one line

Usage:
  swim help                       Show this message
  swim use <alias>                Change active vimrc file
  swim add <file name> <alias>    Add a swim alias
  swim ls                         List aliased vimrc files


Example:
  swim use main          Set $HOME/.swim/.swimrc.main to be your primary .vimrc
  swim use pairing       Set $HOME/.swim/.swimrc.pairing to be your primary .vimrc


Setup:
  Name your vimrc files \"swimrc.<alias>\" and place in $HOME/.swim
  ls $HOME/.swim to see file naming convention.


Report bugs to: https://github.com/dawsonbotsford/swim/issues

Uninstall: \"swim uninstall\"
"
}

function swim_ls() {
  for file in $HOME/.swim/*
  do
    echo $file | cut -d . -f 3
  done
}

function uninstall() {
  rm -rf $HOME/.swim
  #Remove swim from path
  echo "swim uninstalled"
}

function get_alias() {
  path = $1
  return head -n1 $path | cut -d \" -f 2 | cut -d \\ -f 2
}

function add_alias() {
  if [ $# -lt 2 ]
  then
    print_help
    exit
  fi
  src=$1
  dest=$2
  echo "going to move from $1 to alias $2"
  # if [[ ! "$string" =~ "$char" ]]; then

  firstLine=$(head -n1 $1)
  header="$($firstLine | cut -d \^ -f 2)"
  # if [ -z $header ] || [ ! $header =~ \^ ]; then
  if [ -z $header ]; then
    echo "Empty header"
  else
    cp $1 $HOME/.swim/.swimrc.$header
    echo "swim alias \"$header\" added"
  fi
}

#Help conditions
if [ $# -lt 1 ]; then
  print_help
  exit
fi

while [ $# -gt 0 ]; do
  case "$1" in
    help | -h | --help) print_help
      exit;;
    ls | -l) shift
      swim_ls;;
    add | -a) add_alias $2 $3
      exit;;
    use) shift
      if [ -a "$HOME/.swim/swimrc.$1" ]; then
        echo "Now using vimrc file: "$1

        alias=get_alias "$HOME/.vimrc"
        cp $HOME/.vimrc $HOME/.swim/swimrc.$alias
        echo "----moved--"
        echo $(ls $HOME/.swim)
        # vim -u $HOME/.swim/swimrc.$1 test.html

      else
        echo "Alias $1 not found"
      fi
      shift;;
    uninstall) uninstall
               exit;;
    *) print_help
      exit;;
  esac
done


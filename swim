#!/usr/bin/env bash

function print_help() {
  echo "

Switch vimrc files with one line

Usage:
  swim help                         Show this message
  swim with <alias>                 Change active vimrc file
  swim add <pathToFile> <alias>     Add a swim alias
  swim ls                           List aliased vimrc files


Example:
  swim use main          Set $HOME/.swim/.swimrc.main to be your primary .vimrc
  swim use pairing       Set $HOME/.swim/.swimrc.pairing to be your primary .vimrc


Setup:
  Name your vimrc files \"swimrc.<alias>\" and place in $HOME/.swim
  ls $HOME/.swim to see file naming convention.


Report bugs to: https://github.com/dawsonbotsford/swim/issues

Uninstall: \"swim uninstall\"
"
}

function swim_ls() {
  for file in $HOME/.swim/*
  do
    echo $file | cut -d . -f 3
  done
}

function uninstall() {
  rm -rf $HOME/.swim
  #TODO: Remove swim from path
  echo "swim uninstalled"
}

function get_alias() {
  path = $1
  return head -n1 $path | cut -d \" -f 2 | cut -d \\ -f 2
}

function add_alias() {
  if [ $# -lt 2 ]
  then
    print_help
    exit
  fi
  src=$1
  dest=$2

  cp $1 $HOME/.swim/swimrc.$2
  echo "swim alias \"$2\" added"
}

function backup_vimrc (){
  if [ -a "$HOME/.vimrc" ]; then
    mkdir -p $HOME/.swim/oldvimrc
    mv $HOME/.vimrc $HOME/.swim/oldvimrc
  fi
}

#Help conditions
if [ $# -lt 1 ]; then
  print_help
  exit
fi

while [ $# -gt 0 ]; do
  case "$1" in
    help) print_help
      exit;;
    ls | -l) shift
      swim_ls;;
    add | -a) add_alias $2 $3
      exit;;
    active | current) file=$(readlink ~/.vimrc)
                      echo $file | cut -d \. -f 3
      shift;;
    with | use) shift
      if [ -a "$HOME/.swim/swimrc.$1" ]; then
        backup_vimrc
        ln -s $HOME/.swim/swimrc.$1 $HOME/.vimrc
        echo "Swimming with: "$1
      else
        echo "alias $1 not found"
        sleep 1
        print_help
      fi
      shift;;
    uninstall) uninstall
               exit;;
    *) print_help
      exit;;
  esac
done

